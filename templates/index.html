<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Vis-Sol - Generator Ofert PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap&subset=latin-ext" rel="stylesheet">
    <style>
        :root { --vs-navy: #003049; --vs-red: #d62828; }
        body { font-family: 'Roboto', sans-serif; background: #f4f4f4; padding: 20px; font-size: 12px; line-height: 1.4; }
        .app-container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 8px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .section { margin-bottom: 10px; }
        .section label { display: block; margin-bottom: 5px; font-size: 11px; }
        input, textarea { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 11px; }
        textarea { resize: vertical; min-height: 60px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th { background: var(--vs-navy); color: white; padding: 6px 8px; text-align: left; font-size: 10px; border: 2px solid var(--vs-navy); }
        td { padding: 4px 6px; border-bottom: 1px solid #eee; font-size: 11px; }
        td input { padding: 4px; font-size: 10px; }
        .summary { background: var(--vs-navy); color: white; padding: 15px; border-radius: 5px; text-align: right; font-size: 11px; }
        .summary > div { margin: 5px 0; }
        .btn { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; font-size: 13px; }
        
        /* Styl do druku */
        @page {
            size: A4;
            margin: 0;
        }
        @media print {
            .no-print, button, input, textarea { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; padding: 0; margin: 0; font-size: 10px; }
            .app-container { 
                box-shadow: none; 
                border: none; 
                width: 100%;
                max-width: 100%;
                padding: 0;
                margin: 0;
            }
            .watermark {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(-45deg);
                font-size: 100px;
                color: rgba(214, 40, 40, 0.08);
                z-index: 1;
                font-weight: bold;
                pointer-events: none;
                white-space: nowrap;
                letter-spacing: 6px;
            }
            .content-wrapper {
                position: relative;
                z-index: 2;
                padding: 20mm 25mm;
                box-sizing: border-box;
            }
            .grid { gap: 10px; margin-bottom: 10px; }
            .section { margin-bottom: 5px; }
            .section label { margin-bottom: 3px; font-size: 10px; }
            .print-text { 
                white-space: pre-line; 
                font-size: 9px; 
                line-height: 1.4;
            }
            table { 
                page-break-inside: auto; 
                margin: 10px 0;
                font-size: 9px;
                width: 100%;
            }
            tr { page-break-inside: avoid; page-break-after: auto; }
            thead { display: table-header-group; }
            th {
                border: 2px solid var(--vs-navy) !important;
                border-bottom: 3px solid var(--vs-navy) !important;
                padding: 5px 4px;
                font-size: 9px;
            }
            td { 
                padding: 3px 4px; 
                font-size: 9px;
            }
            .summary {
                page-break-inside: avoid;
                padding: 10px;
                font-size: 10px;
            }
            .summary > div { margin: 3px 0; }
            .header-section {
                border-bottom: 3px solid var(--vs-navy);
                padding-bottom: 8px;
                margin-bottom: 12px;
            }
            .header-section h1 {
                font-size: 24px !important;
            }
            .header-right {
                font-size: 10px !important;
            }
        }
        .print-only { display: none; }
        .content-wrapper { position: relative; z-index: 2; }
        .header-section {
            border-bottom: 4px solid var(--vs-navy);
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .header-section h1 { margin: 0; color: var(--vs-navy); font-size: 28px; }
        .header-right { text-align: right; font-size: 11px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="watermark print-only">WERSJA DEMONSTRACYJNA</div>
    
    <div class="content-wrapper">
        <div class="header-section">
            <h1>VIS-SOL</h1>
            <div class="header-right"><strong>OFERTA HANDLOWA <span id="oh_val"></span></strong><br>vis-sol.prv.pl</div>
        </div>

        <div class="grid">
            <div class="section">
                <label><strong>WYSTAWCA</strong></label>
                <textarea id="off_info" rows="3" class="no-print">Vis-Sol Visuals and Solutions&#10;NIP: [Twój NIP]&#10;Tel: [Twój tel]&#10;E-mail: kontakt@vis-sol.prv.pl</textarea>
                <div class="print-only print-text" id="off_p"></div>
            </div>
            <div class="section">
                <label><strong>KLIENT</strong></label>
                <textarea id="cli_info" rows="3" class="no-print" placeholder="Wpisz dane klienta, adres, NIP..."></textarea>
                <div class="print-only print-text" id="cli_p"></div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th width="25">LP</th>
                    <th>Opis usługi / produktu</th>
                    <th width="45">Jm</th>
                    <th width="45">Ilość</th>
                    <th width="75" class="no-print">Cena Zak.</th>
                    <th width="55" class="no-print">Marża %</th>
                    <th width="85">Cena Netto</th>
                    <th width="55">VAT</th>
                    <th width="95">Brutto</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
        <button class="btn no-print" style="background:#27ae60; color:white; width:auto; padding: 8px 15px;" onclick="addRow()">+ Dodaj pozycję</button>

        <div class="grid" style="margin-top:15px;">
            <div class="section">
                <label><strong>WARUNKI I INFORMACJE HANDLOWE</strong></label>
                <textarea id="terms" rows="3" class="no-print">Termin ważności: 14 dni&#10;Płatność: 25% zaliczka / 75% po realizacji&#10;Gwarancja: 24 miesiące&#10;Ceny mogą ulec zmianie o +/- 10% rynkowo.</textarea>
                <div class="print-only print-text" id="terms_p"></div>
            </div>
            <div class="summary">
                <div>Suma Netto: <span id="sNet">0.00</span> PLN</div>
                <div style="color:#ffadad">Rabat: -<input type="number" id="disc" value="0" style="width:60px; background:none; border:1px solid #777; color:white; padding:3px;" oninput="calc()"> PLN</div>
                <div style="font-size: 18px; font-weight: bold; margin-top:8px; color:#f77f00;">DO ZAPŁATY: <span id="sTotal">0.00</span> PLN</div>
            </div>
        </div>

        <button class="btn no-print" style="background:var(--vs-red); color:white; font-size:14px; margin-top: 15px;" onclick="prepareAndPrint()">ZATWIERDŹ I DRUKUJ OFERTĘ (PDF)</button>
    </div>
</div>

<script>
    let oh = `OH/${new Date().getFullYear()}/${new Date().getMonth()+1}/${Math.floor(100+Math.random()*900)}`;
    document.getElementById('oh_val').innerText = oh;

    function addRow() {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${document.getElementById('tbody').rows.length + 1}</td>
            <td><input type="text" class="d"></td>
            <td><input type="text" value="szt." class="j"></td>
            <td><input type="number" value="1" class="q" oninput="calc()"></td>
            <td class="no-print"><input type="number" value="0" class="cz" oninput="calc()"></td>
            <td class="no-print"><input type="number" value="0" class="m" oninput="calc()"></td>
            <td><span class="cn">0.00</span></td>
            <td><select class="v" onchange="calc()"><option value="0.23">23%</option><option value="0.08">8%</option><option value="0">zw</option></select></td>
            <td><span class="cb">0.00</span></td>`;
        document.getElementById('tbody').appendChild(tr);
    }

    function calc() {
        let n = 0, v = 0;
        document.querySelectorAll('#tbody tr').forEach(r => {
            let cz = parseFloat(r.querySelector('.cz').value)||0;
            let m = parseFloat(r.querySelector('.m').value)||0;
            let q = parseFloat(r.querySelector('.q').value)||0;
            let vt = parseFloat(r.querySelector('.v').value)||0;
            
            let cenaNettoZMarza = cz * (1 + m/100);
            let rowNetto = cenaNettoZMarza * q;
            r.querySelector('.cn').innerText = cenaNettoZMarza.toFixed(2);
            r.querySelector('.cb').innerText = (rowNetto * (1+vt)).toFixed(2);
            n += rowNetto; v += (rowNetto * vt);
        });
        let d = parseFloat(document.getElementById('disc').value)||0;
        document.getElementById('sNet').innerText = (n - d).toFixed(2);
        document.getElementById('sTotal').innerText = (n - d + v).toFixed(2);
    }

    function prepareAndPrint() {
        document.getElementById('off_p').innerText = document.getElementById('off_info').value;
        document.getElementById('cli_p').innerText = document.getElementById('cli_info').value;
        document.getElementById('terms_p').innerText = document.getElementById('terms').value;
        
        document.querySelectorAll('#tbody tr').forEach(r => {
            const descInput = r.querySelector('.d');
            if (descInput) descInput.parentElement.innerHTML = `<span>${descInput.value}</span>`;

            const jmInput = r.querySelector('.j');
            if (jmInput) jmInput.parentElement.innerHTML = `<span>${jmInput.value}</span>`;

            const qInput = r.querySelector('.q');
            if (qInput) qInput.parentElement.innerHTML = `<span>${qInput.value}</span>`;

            const cnSpan = r.querySelector('.cn');
            if (cnSpan) cnSpan.parentElement.innerHTML = `<span>${cnSpan.innerText}</span>`;

            const vatSelect = r.querySelector('.v');
            if (vatSelect) {
                const vatText = vatSelect.options[vatSelect.selectedIndex].text;
                vatSelect.parentElement.innerHTML = `<span>${vatText}</span>`;
            }

            const cbSpan = r.querySelector('.cb');
            if (cbSpan) cbSpan.parentElement.innerHTML = `<span>${cbSpan.innerText}</span>`;
        });

        window.print();
        location.reload();
    }
    addRow();
</script>
</body>
</html>
