<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Vis-Sol - Generator Ofert PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap&subset=latin-ext" rel="stylesheet">
    <style>
        :root { --vs-navy: #003049; --vs-red: #d62828; }
        body { font-family: 'Roboto', sans-serif; background: #f4f4f4; padding: 20px; font-size: 12px; }
        .app-container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 8px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: var(--vs-navy); color: white; padding: 8px; text-align: left; font-size: 11px; }
        td { padding: 6px; border-bottom: 1px solid #eee; }
        .summary { background: var(--vs-navy); color: white; padding: 20px; border-radius: 5px; text-align: right; }
        .btn { padding: 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        
        /* Styl do druku - tu znikają pola edycji, zostaje czysty tekst */
        @media print {
            .no-print, button, input, textarea { display: none !important; }
            .print-only { display: block !important; }
            body { background: white; padding: 0; }
            .app-container { box-shadow: none; border: none; width: 100%; }
            .watermark { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 80px; color: rgba(0,0,0,0.05); z-index: -1; }
        }
        .print-only { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="watermark print-only">VIS-SOL OFFICIAL</div>
    
    <div style="border-bottom: 4px solid var(--vs-navy); display: flex; justify-content: space-between; align-items: flex-end; padding-bottom: 10px; margin-bottom: 20px;">
        <h1 style="margin:0; color:var(--vs-navy);">VIS-SOL</h1>
        <div style="text-align:right"><strong>OFERTA HANDLOWA <span id="oh_val"></span></strong><br>vis-sol.prv.pl</div>
    </div>

    <div class="grid">
        <div class="section">
            <label><strong>WYSTAWCA</strong></label>
            <textarea id="off_info" rows="4">Vis-Sol Visuals and Solutions&#10;NIP: [Twój NIP]&#10;Tel: [Twój tel]&#10;E-mail: kontakt@vis-sol.prv.pl</textarea>
            <div class="print-only" id="off_p"></div>
        </div>
        <div class="section">
            <label><strong>KLIENT</strong></label>
            <textarea id="cli_info" rows="4" placeholder="Wpisz dane klienta, adres, NIP..."></textarea>
            <div class="print-only" id="cli_p"></div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th width="30">LP</th>
                <th>Opis usługi / produktu</th>
                <th width="50">Jm</th>
                <th width="50">Ilość</th>
                <th width="80" class="no-print">Cena Zak.</th>
                <th width="60" class="no-print">Marża %</th>
                <th width="90">Cena Netto</th>
                <th width="60">VAT</th>
                <th width="100">Brutto</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
    <button class="btn no-print" style="background:#27ae60; color:white; width:auto;" onclick="addRow()">+ Dodaj pozycję</button>

    <div class="grid" style="margin-top:20px;">
        <div class="section">
            <label><strong>WARUNKI I INFORMACJE HANDLOWE</strong></label>
            <textarea id="terms" rows="4">Termin ważności: 14 dni&#10;Płatność: 25% zaliczka / 75% po realizacji&#10;Gwarancja: 24 miesiące&#10;Ceny mogą ulec zmianie o +/- 10% rynkowo.</textarea>
            <div class="print-only" id="terms_p"></div>
        </div>
        <div class="summary">
            <div>Suma Netto: <span id="sNet">0.00</span> PLN</div>
            <div style="color:#ffadad">Rabat: -<input type="number" id="disc" value="0" style="width:60px; background:none; border:1px solid #777; color:white" oninput="calc()"> PLN</div>
            <div style="font-size: 20px; font-weight: bold; margin-top:10px; color:#f77f00;">DO ZAPŁATY: <span id="sTotal">0.00</span> PLN</div>
        </div>
    </div>

    <button class="btn no-print" style="background:var(--vs-red); color:white; font-size:16px;" onclick="prepareAndPrint()">ZATWIERDŹ I DRUKUJ OFERTĘ (PDF)</button>
</div>

<script>
    let oh = `OH/${new Date().getFullYear()}/${new Date().getMonth()+1}/${Math.floor(100+Math.random()*900)}`;
    document.getElementById('oh_val').innerText = oh;

    function addRow() {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${document.getElementById('tbody').rows.length + 1}</td>
            <td><input type="text" class="d"></td><td><input type="text" value="szt." class="j"></td>
            <td><input type="number" value="1" class="q" oninput="calc()"></td>
            <td class="no-print"><input type="number" value="0" class="cz" oninput="calc()"></td>
            <td class="no-print"><input type="number" value="0" class="m" oninput="calc()"></td>
            <td><span class="cn">0.00</span></td>
            <td><select class="v" onchange="calc()"><option value="0.23">23%</option><option value="0.08">8%</option><option value="0">zw</option></select></td>
            <td><span class="cb">0.00</span></td>`;
        document.getElementById('tbody').appendChild(tr);
    }

    function calc() {
        let n = 0, v = 0;
        document.querySelectorAll('#tbody tr').forEach(r => {
            let cz = parseFloat(r.querySelector('.cz').value)||0;
            let m = parseFloat(r.querySelector('.m').value)||0;
            let q = parseFloat(r.querySelector('.q').value)||0;
            let vt = parseFloat(r.querySelector('.v').value)||0;
            
            let cenaNettoZMarza = cz * (1 + m/100);
            let rowNetto = cenaNettoZMarza * q;
            r.querySelector('.cn').innerText = cenaNettoZMarza.toFixed(2);
            r.querySelector('.cb').innerText = (rowNetto * (1+vt)).toFixed(2);
            n += rowNetto; v += (rowNetto * vt);
        });
        let d = parseFloat(document.getElementById('disc').value)||0;
        document.getElementById('sNet').innerText = (n - d).toFixed(2);
        document.getElementById('sTotal').innerText = (n - d + v).toFixed(2);
    }

    function prepareAndPrint() {
        // Przenieś dane z pól edycji do tekstu (dla druku)
        document.getElementById('off_p').innerText = document.getElementById('off_info').value;
        document.getElementById('cli_p').innerText = document.getElementById('cli_info').value;
        document.getElementById('terms_p').innerText = document.getElementById('terms').value;
        
        // Zamień inputy w tabeli na tekst tylko do druku
        document.querySelectorAll('#tbody tr').forEach(r => {
            const desc = r.querySelector('.d').value;
            r.cells[1].innerHTML = `<span>${desc}</span>`;
            const jm = r.querySelector('.j').value;
            r.cells[2].innerHTML = `<span>${jm}</span>`;
        });

        window.print();
        location.reload(); // Odśwież, żeby wrócić do trybu edycji
    }
    addRow();
</script>
</body>
</html>
