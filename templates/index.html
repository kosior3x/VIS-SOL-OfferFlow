<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Vis-Sol Official Quote System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --vs-navy: #003049; --vs-red: #d62828; }
        body { font-family: 'Arial', sans-serif; background: #f4f4f4; color: #333; }
        .app-container { max-width: 900px; margin: 30px auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .vs-header { display: flex; justify-content: space-between; border-bottom: 5px solid var(--vs-navy); padding-bottom: 15px; margin-bottom: 25px; }
        .vs-company-info { font-size: 14px; color: var(--vs-navy); font-weight: bold; }
        .oh-number { color: var(--vs-red); font-size: 20px; font-weight: bold; }
        .info-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .info-table th { background: var(--vs-navy); color: white; padding: 12px; text-align: left; }
        .summary { background: var(--vs-navy); color: white; padding: 25px; border-radius: 5px; text-align: right; margin-top: 25px; }
        .btn-gen { background: var(--vs-red); color: white; border: none; padding: 18px; width: 100%; font-size: 18px; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 20px; }
        .watermark { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 80px; color: rgba(0,0,0,0.03); pointer-events: none; z-index: 0; }
    </style>
</head>
<body>

<div class="watermark">VIS-SOL OFFICIAL</div>

<div class="app-container">
    <div class="vs-header">
        <div>
            <h1 style="margin:0; font-size: 35px; color: var(--vs-navy);">VIS-SOL</h1>
            <div class="oh-number" id="oh-num">Ładowanie...</div>
        </div>
        <div class="vs-company-info">
            Wystawca: Vis-Sol Visuals and Solutions<br>
            Strona: vis-sol.prv.pl
        </div>
    </div>

    <div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-left: 5px solid var(--vs-red);">
        <strong>Klient:</strong> Vis-Sol Test / Demo User
    </div>

    <table class="info-table">
        <thead>
            <tr><th>Opis pozycji</th><th width="70">Jm</th><th width="70">Ilość</th><th width="120">Cena N</th><th width="80">VAT</th><th>Suma B</th></tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>
    <button onclick="addRow()" style="margin-top:10px; cursor:pointer;">+ Dodaj usługę/materiał</button>

    <div class="summary">
        <div>Netto: <span id="sNet">0.00</span> PLN</div>
        <div style="color: #ff9e9e;">Rabat: -<input type="number" id="disc" value="0" style="width:70px; background:none; border:1px solid white; color:white; padding:3px;" oninput="calc()"> PLN</div>
        <div style="font-size: 24px; font-weight: bold; margin-top: 10px;">DO ZAPŁATY: <span id="sTotal">0.00</span> PLN</div>
    </div>

    <div style="margin-top:20px; font-size: 12px; color: #666;">
        <strong>INFORMACJE HANDLOWE:</strong><br>
        * Termin ważności oferty: 14 dni<br>
        * Warunki płatności: 50% zaliczka / 50% po realizacji<br>
        * Gwarancja: 24 miesiące<br>
        * Zastrzeżenie: Ceny materiałów mogą ulec zmianie o +/- 10% przy gwałtownych skokach rynkowych.
    </div>

    <button class="btn-gen" onclick="generatePDF()">GENERUJ OFICJALNY PDF (OH)</button>
</div>

<script>
    let oh = `OH/2026/01/${Math.floor(100+Math.random()*900)}`;
    document.getElementById('oh-num').innerText = "NR: " + oh;

    function addRow() {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input type="text" style="width:95%"></td><td><input type="text" value="szt." style="width:90%"></td><td><input type="number" value="1" oninput="calc()" style="width:90%"></td><td><input type="number" value="0" oninput="calc()" style="width:90%"></td><td><select onchange="calc()"><option value="0.23">23%</option><option value="0.08">8%</option></select></td><td class="b_row" style="font-weight:bold">0.00</td>`;
        document.getElementById('rows').appendChild(tr);
    }

    function calc() {
        let n = 0, v = 0;
        document.querySelectorAll('#rows tr').forEach(r => {
            let q = r.cells[2].children[0].value, p = r.cells[3].children[0].value, vt = r.cells[4].children[0].value;
            let rn = q * p; n += rn; v += rn * vt;
            r.querySelector('.b_row').innerText = (rn * (1+parseFloat(vt))).toFixed(2);
        });
        let d = document.getElementById('disc').value;
        document.getElementById('sNet').innerText = (n - d).toFixed(2);
        document.getElementById('sTotal').innerText = (n - d + v).toFixed(2);
    }

    function generatePDF() {
        const doc = new jspdf.jsPDF();
        doc.setTextColor(240); doc.setFontSize(60); doc.text("VIS-SOL OFFICIAL", 35, 150, {angle:45});
        doc.setTextColor(0, 48, 73); doc.setFontSize(22); doc.text("OFERTA HANDLOWA " + oh, 15, 25);
        doc.setFontSize(10); doc.setTextColor(100);
        doc.text("Wystawca: Vis-Sol Visuals and Solutions", 15, 35);
        doc.text("Klient: Vis-Sol Test / Demo User", 15, 42);
        
        const tableData = [];
        document.querySelectorAll('#rows tr').forEach(r => {
            tableData.push([r.cells[0].children[0].value, r.cells[1].children[0].value, r.cells[2].children[0].value, r.cells[3].children[0].value, r.cells[4].children[0].selectedOptions[0].text, r.cells[5].innerText]);
        });

        doc.autoTable({ startY: 50, head: [['Opis', 'Jm', 'Ilość', 'Cena Netto', 'VAT', 'Brutto']], body: tableData, headStyles: {fillColor: [0, 48, 73]} });

        let y = doc.lastAutoTable.finalY + 15;
        doc.setFontSize(14); doc.setTextColor(214, 48, 49);
        doc.text("DO ZAPŁATY BRUTTO: " + document.getElementById('sTotal').innerText + " PLN", 195, y, {align:'right'});
        
        doc.setFontSize(10); doc.setTextColor(50);
        doc.text("INFORMACJE HANDLOWE:", 15, y+10);
        doc.setFontSize(9); doc.text("* Termin ważności: 14 dni", 15, y+17);
        doc.text("* Warunki płatności: 50/50", 15, y+23);
        doc.text("* Gwarancja: 24 miesiące", 15, y+29);
        doc.text("* Zastrzeżenie: Ceny materiałów +/- 10% rynkowo.", 15, y+35);
        
        doc.save(`oferta_nr_${oh.replace(/\//g,'_')}.pdf`);
    }
    addRow();
</script>
</body>
</html>
