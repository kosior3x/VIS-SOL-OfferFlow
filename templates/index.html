<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Vis-Sol Professional Quote System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --vs-dark: #003049; --vs-red: #d62828; }
        body { font-family: 'Arial', sans-serif; background: #f4f4f4; padding: 20px; }
        .app-container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; border-bottom: 4px solid var(--vs-dark); padding-bottom: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: var(--vs-dark); color: white; padding: 10px; text-align: left; }
        .dupochron { background: #eee; padding: 15px; margin-top: 20px; border-radius: 5px; font-size: 12px; }
        .btn-gen { background: var(--vs-red); color: white; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 20px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div><h1>VIS-SOL</h1><p id="oh_num" style="color:var(--vs-red); font-weight:bold;"></p></div>
            <div>vis-sol.prv.pl</div>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <input type="text" id="cli" placeholder="Dane Klienta">
            <input type="text" id="nip" placeholder="NIP">
        </div>

        <table>
            <thead><tr><th>Opis</th><th>Jm</th><th>Ilość</th><th>Cena N</th><th>VAT</th><th>Suma B</th></tr></thead>
            <tbody id="rows"></tbody>
        </table>
        <button onclick="addRow()">+ Dodaj pozycję</button>

        <div style="text-align: right; margin-top: 20px;">
            <p>Suma Netto: <span id="tNet">0.00</span> PLN</p>
            <p>Rabat: -<input type="number" id="disc" value="0" oninput="calc()" style="width:60px"> PLN</p>
            <p style="font-size: 20px; font-weight: bold;">DO ZAPŁATY: <span id="tBrut">0.00</span> PLN</p>
        </div>

        <div class="dupochron">
            <p><b>Informacje i zabezpieczenia:</b></p>
            <input type="text" id="vld" value="Termin ważności oferty: 14 dni">
            <input type="text" id="pay" value="Warunki płatności: 50% zaliczka / 50% po realizacji">
            <input type="text" id="war" value="Gwarancja: 24 miesiące">
            <p>* Ceny mogą ulec zmianie przy skokach cen materiałów o +/- 10%.</p>
        </div>

        <button class="btn-gen" onclick="genPDF()">GENERUJ PDF OFERTY OH</button>
    </div>

    <script>
        let oh = `OH/2026/01/${Math.floor(100+Math.random()*900)}`;
        document.getElementById('oh_num').innerText = "NR: " + oh;

        function addRow() {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td><input type="text" class="d"></td><td><input type="text" class="j" value="szt."></td><td><input type="number" class="q" value="1" oninput="calc()"></td><td><input type="number" class="p" value="0" oninput="calc()"></td><td><select class="v" onchange="calc()"><option value="0.23">23%</option><option value="0.08">8%</option></select></td><td class="b">0.00</td>`;
            document.getElementById('rows').appendChild(tr);
        }

        function calc() {
            let n = 0, v = 0;
            document.querySelectorAll('#rows tr').forEach(r => {
                let q = r.querySelector('.q').value, p = r.querySelector('.p').value, vt = r.querySelector('.v').value;
                let rn = q * p; n += rn; v += rn * vt;
                r.querySelector('.b').innerText = (rn * (1+parseFloat(vt))).toFixed(2);
            });
            let d = document.getElementById('disc').value;
            document.getElementById('tNet').innerText = (n - d).toFixed(2);
            document.getElementById('tBrut').innerText = (n - d + v).toFixed(2);
        }

        function genPDF() {
            const doc = new jspdf.jsPDF();
            doc.text("OFERTA HANDLOWA " + oh, 10, 20);
            doc.text("Klient: " + document.getElementById('cli').value, 10, 30);
            // ... (logika autoTable jak wcześniej, ale z poprawnym nazewnictwem)
            doc.save(`oferta_nr_${oh.replace(/\//g,'_')}.pdf`);
        }
        addRow();
    </script>
</body>
</html>
